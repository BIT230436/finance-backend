spring.application.name=finance-backend

# ========== MySQL Datasource ==========
# Update username/password to match your MySQL Workbench user
spring.datasource.url=jdbc:mysql://localhost:3306/finance_db?useSSL=false&allowPublicKeyRetrieval=true&serverTimezone=UTC&characterEncoding=UTF-8
spring.datasource.username=root
spring.datasource.password=123456
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

# Connection pool (Hikari)
spring.datasource.hikari.maximum-pool-size=10

# ========== JPA / Hibernate ==========
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.open-in-view=false
spring.jpa.database-platform=org.hibernate.dialect.MySQLDialect
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQLDialect

# SQL init behavior (disable running schema.sql/data.sql automatically)
spring.sql.init.mode=never

# ========== Session Management ==========
# Configure session timeout for OAuth2 flow (30 minutes)
# This ensures session persists through OAuth2 redirect flow
spring.session.timeout=30m
# Cookie settings for session
server.servlet.session.cookie.http-only=true
server.servlet.session.cookie.secure=false
server.servlet.session.cookie.name=JSESSIONID
server.servlet.session.cookie.path=/
server.servlet.session.cookie.max-age=1800
# Track sessions to prevent premature invalidation
server.servlet.session.tracking-modes=cookie

# ========== Logging (dev) ==========
# logging.level.org.hibernate.SQL=DEBUG
# logging.level.org.hibernate.orm.jdbc.bind=TRACE
# OAuth2 Client debug logging - uncomment to debug OAuth2 issues
logging.level.org.springframework.security.oauth2.client=DEBUG
logging.level.org.springframework.security.oauth2=DEBUG

# ========== JWT ==========
jwt.secret=${JWT_SECRET:your-256-bit-secret-key-change-in-production-minimum-32-characters}
jwt.access-token-ttl=86400000
jwt.refresh-token-ttl=604800000

# ========== OAuth2 Google ==========
# OAuth2 is optional - remove or comment out these lines if you don't have Google OAuth credentials yet
# To enable OAuth2:
# 1. Get credentials from Google Cloud Console (https://console.cloud.google.com/apis/credentials)
# 2. Create OAuth 2.0 Client ID (Web application)
# 3. Set Authorized redirect URIs: http://localhost:8080/login/oauth2/code/google (for dev)
# 4. Set environment variables: GOOGLE_CLIENT_ID and GOOGLE_CLIENT_SECRET
#    - Windows PowerShell: $env:GOOGLE_CLIENT_ID="your-client-id"
#    - Windows CMD: set GOOGLE_CLIENT_ID=your-client-id
#    - Linux/Mac: export GOOGLE_CLIENT_ID="your-client-id"
#    Or use SETUP_OAUTH2.bat / SETUP_OAUTH2.ps1 script
# 
# NOTE: If GOOGLE_CLIENT_ID is not set, OAuth2 auto-configuration will be disabled automatically
# to prevent BeanCreationException. Application will start normally without OAuth2.
# The exclusion is handled in SecurityConfig based on client-id value.
spring.security.oauth2.client.registration.google.client-id=${GOOGLE_CLIENT_ID:}
spring.security.oauth2.client.registration.google.client-secret=${GOOGLE_CLIENT_SECRET:}
spring.security.oauth2.client.registration.google.scope=openid,profile,email
# NOTE: Do NOT set redirect-uri explicitly - Spring Security OAuth2 Client automatically
# constructs it as: {baseUrl}/login/oauth2/code/{registrationId}
# For registrationId="google", it will be: http://localhost:8080/login/oauth2/code/google
# Setting it explicitly may cause mismatch with Google Console configuration
# Force account selection will be configured in SecurityConfig.java using additionalParameters
spring.security.oauth2.client.provider.google.authorization-uri=https://accounts.google.com/o/oauth2/v2/auth
spring.security.oauth2.client.provider.google.token-uri=https://oauth2.googleapis.com/token
spring.security.oauth2.client.provider.google.user-info-uri=https://www.googleapis.com/oauth2/v2/userinfo
spring.security.oauth2.client.provider.google.user-name-attribute=email

# ========== File Upload ==========
spring.servlet.multipart.enabled=true
spring.servlet.multipart.max-file-size=5MB
spring.servlet.multipart.max-request-size=5MB

# ========== Date/Time Format ==========
# Use ISO 8601 format for dates (YYYY-MM-DDTHH:mm:ss) to ensure compatibility with frontend
spring.jackson.serialization.write-dates-as-timestamps=false
spring.jackson.serialization.write-date-timestamps-as-nanoseconds=false
spring.jackson.time-zone=Asia/Ho_Chi_Minh
spring.jackson.date-format=yyyy-MM-dd'T'HH:mm:ss
spring.jackson.default-property-inclusion=non_null
# ========== Google reCAPTCHA ==========
# L?y Secret Key t? Google reCAPTCHA Admin Console
# https://www.google.com/recaptcha/admin/
# QUAN TR?NG: ??t giá tr? này trong Environment Variable
google.recaptcha.secret-key=${6LegxAEsAAAAAMvIJDiZCEDBEYavi_dEKl-u0jWd:}

# ========== Frontend Configuration ==========
# Frontend URL for OAuth2 redirect after successful login
# Default: http://localhost:3000 (React default port)
# Update this to match your frontend URL
frontend.url=${FRONTEND_URL:http://localhost:3000}
frontend.oauth2.success.path=${FRONTEND_OAUTH2_SUCCESS_PATH:/auth/callback}
frontend.oauth2.error.path=${FRONTEND_OAUTH2_ERROR_PATH:/auth/error}

# ========== Email Configuration (Spring Mail) ==========
# Email service is OPTIONAL - set spring.mail.enabled=true to enable
# For Gmail, you need to use App Password (not your regular password)
# Generate at: https://myaccount.google.com/apppasswords
spring.mail.enabled=${MAIL_ENABLED:false}
spring.mail.host=${MAIL_HOST:smtp.gmail.com}
spring.mail.port=${MAIL_PORT:587}
spring.mail.username=${MAIL_USERNAME:your-email@gmail.com}
spring.mail.password=${MAIL_PASSWORD:your-app-password}
spring.mail.properties.mail.smtp.auth=true
spring.mail.properties.mail.smtp.starttls.enable=true
spring.mail.properties.mail.smtp.starttls.required=true
spring.mail.properties.mail.smtp.connectiontimeout=5000
spring.mail.properties.mail.smtp.timeout=5000
spring.mail.properties.mail.smtp.writetimeout=5000

# Disable mail health check (mail is optional, don't fail if not configured)
management.health.mail.enabled=false

# Email Configuration Instructions:
# 1. Set MAIL_ENABLED=true to enable email service
# 2. For Gmail:
#    - Enable 2-Step Verification
#    - Generate App Password at https://myaccount.google.com/apppasswords
#    - Use that app password as MAIL_PASSWORD
# 3. Set MAIL_USERNAME to your email address
# 4. Restart application
# 
# Environment variables example:
# Windows PowerShell: $env:MAIL_ENABLED="true"
# Windows CMD: set MAIL_ENABLED=true
# Linux/Mac: export MAIL_ENABLED=true

# ========== Swagger / OpenAPI Configuration ==========
# Access Swagger UI at: http://localhost:8080/swagger-ui.html
# Access OpenAPI JSON at: http://localhost:8080/v3/api-docs
springdoc.api-docs.enabled=true
springdoc.swagger-ui.enabled=true
springdoc.swagger-ui.path=/swagger-ui.html
springdoc.swagger-ui.operations-sorter=method
springdoc.swagger-ui.tags-sorter=alpha
springdoc.swagger-ui.try-it-out-enabled=true
springdoc.swagger-ui.filter=true
springdoc.show-actuator=false